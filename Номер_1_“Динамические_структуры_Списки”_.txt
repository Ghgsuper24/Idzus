/*

Дано два однонаправленных списка целых чисел.Сформировать третий список, содержащий
числа Фибоначчи исходных списков.

*/

#include <iostream>
#include <list>
#include <set>
#include <clocale>
#include <cmath>

using namespace std;


/*

Числа Фибоначчи — это последовательность чисел, 
в которой каждое число (начиная с третьего) является суммой двух предыдущих.

*/


// Функция для проверки, является ли число числом Фибоначчи
bool Fib(int num)
{
    // Если число отрицательное, оно не может быть числом Фибоначчи
    if (num < 0) return false;
    int a = 0, b = 1;
    // Проверка, пока текущее число Фибоначчи меньше проверяемого
    while (b < num)
    {
        int temp = b;
        b = a + b; // Переход к следующему числу Фибоначчи
        a = temp;
    }
    // Возвращаем true, если число совпадает с Фибоначчи или равно нулю
    return (b == num || num == 0);
}

// Функция для формирования списка чисел Фибоначчи из двух исходных списков
list<int> FormList(const list<int>& l1, const list<int>& l2)
{
    list<int> result; // Итоговый список чисел Фибоначчи
    set<int> uniqueNums; // Множество для исключения дубликатов

    // Проверка чисел из первого списка
    for (int num : l1)
    {
        if (Fib(num))
        {
            uniqueNums.insert(num); // Добавляем число, если оно является Фибоначчи
        }
    }

    // Проверка чисел из второго списка
    for (int num : l2)
    {
        if (Fib(num))
        {
            uniqueNums.insert(num); // Добавляем число, если оно является Фибоначчи
        }
    }

    // Перенос уникальных чисел Фибоначчи в итоговый список
    for (int num : uniqueNums)
    {
        result.push_back(num);
    }
    return result;
}

// Основная функция для выполнения задачи №1
void task_01()
{
    setlocale(LC_ALL, "Rus");
    cout << "\nФормирование списка чисел Фибоначчи из двух однонаправленных списков.\n";

    list<int> list1, list2; // Два исходных списка
    int n1, n2, num;

    // Ввод первого списка чисел
    cout << "Введите количество элементов первого списка: ";
    cin >> n1;
    cout << "Введите элементы первого списка:\n";
    for (int i = 0; i < n1; i++)
    {
        cin >> num;
        list1.push_back(num);
    }

    // Ввод второго списка чисел
    cout << "Введите количество элементов второго списка: ";
    cin >> n2;
    cout << "Введите элементы второго списка:\n";
    for (int i = 0; i < n2; i++)
    {
        cin >> num;
        list2.push_back(num);
    }

    // Формирование списка чисел Фибоначчи
    list<int> fibonacciList = FormList(list1, list2);

    // Вывод чисел Фибоначчи из итогового списка
    cout << "\nЧисла Фибоначчи из обоих списков:\n";
    for (int num : fibonacciList)
    {
        cout << num << " ";
    }
    cout << endl;
}

// Главная функция программы
int main() 
{
    setlocale(LC_ALL, "Rus");
    task_01(); // Запуск задачи №1
    return 0;
}
